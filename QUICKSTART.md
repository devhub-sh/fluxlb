# FluxLB Quick Start Guide

This guide will help you get FluxLB up and running in minutes.

## Prerequisites

- Go 1.16+ installed
- (Optional) Node.js 14+ and npm for React dashboard

## Quick Start (5 minutes)

### 1. Clone and Build

```bash
git clone https://github.com/devhub-sh/fluxlb.git
cd fluxlb
chmod +x setup.sh
./setup.sh
```

The setup script will:
- Build the Go binary
- Install and build React frontend (if Node.js is available)
- Generate self-signed TLS certificates for development
- Prepare the application for first run

### 2. Start Test Backends

Open 3 separate terminals and run:

```bash
# Terminal 1
go run examples/test_backend.go 8081

# Terminal 2
go run examples/test_backend.go 8082

# Terminal 3
go run examples/test_backend.go 8083
```

### 3. Start FluxLB

In a new terminal:

```bash
./fluxlb -config config.json
```

You should see:
```
FluxLB starting with 3 backends on port 8080
Added backend: http://localhost:8081
Added backend: http://localhost:8082
Added backend: http://localhost:8083
FluxLB HTTP listening on http://localhost:8080
Dashboard available at http://localhost:8080/dashboard
```

### 4. Access the Dashboard

Open your browser and navigate to:
```
http://localhost:8080/dashboard
```

Login with default credentials:
- **Username:** `admin`
- **Password:** `admin123`

## Testing Load Balancing

Send some test requests:

```bash
# Send 10 requests
for i in {1..10}; do curl http://localhost:8080/; done
```

Watch the dashboard update with:
- Request counts
- Average latency
- Requests per second
- Active connections
- Time quanta (processing time)

## Managing Backends

### Add a Backend (from Dashboard)

1. Click "Add Backend" button
2. Enter backend URL (e.g., `http://localhost:8084`)
3. Click "Add Backend"

### Add a Backend (via API)

```bash
# Login first
curl -X POST http://localhost:8080/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  -c cookies.txt

# Add backend
curl -X POST http://localhost:8080/api/backends/add \
  -H "Content-Type: application/json" \
  -d '{"url":"http://localhost:8084"}' \
  -b cookies.txt
```

### Remove a Backend

From the dashboard, click "Remove" button on any backend card.

## Enabling HTTPS

1. Certificates are already generated by setup.sh
2. Edit `config.json`:
   ```json
   {
     "enable_https": true,
     "https_port": 8443,
     ...
   }
   ```
3. Restart FluxLB
4. Access at: `https://localhost:8443/dashboard`

**Note:** Browser will show a warning for self-signed certificates. This is normal for development.

## Production Deployment

### 1. Change Default Credentials

Edit `config.json`:
```json
{
  "auth": {
    "enabled": true,
    "username": "your-username",
    "password": "strong-password"
  }
}
```

### 2. Get Production Certificates

Use Let's Encrypt for free production certificates:

```bash
# Install certbot
sudo apt-get install certbot

# Get certificate
sudo certbot certonly --standalone -d yourdomain.com

# Update config.json
{
  "cert_file": "/etc/letsencrypt/live/yourdomain.com/fullchain.pem",
  "key_file": "/etc/letsencrypt/live/yourdomain.com/privkey.pem"
}
```

### 3. Configure Your Backends

Edit `config.json` to point to your actual backend servers:

```json
{
  "backends": [
    {"url": "http://backend1.internal:8080"},
    {"url": "http://backend2.internal:8080"},
    {"url": "http://backend3.internal:8080"}
  ]
}
```

### 4. Run as a Service

Create `/etc/systemd/system/fluxlb.service`:

```ini
[Unit]
Description=FluxLB Load Balancer
After=network.target

[Service]
Type=simple
User=fluxlb
WorkingDirectory=/opt/fluxlb
ExecStart=/opt/fluxlb/fluxlb -config /opt/fluxlb/config.json
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

Enable and start:
```bash
sudo systemctl enable fluxlb
sudo systemctl start fluxlb
sudo systemctl status fluxlb
```

## Architecture Overview

```
┌─────────────────────────────────────────────────┐
│                   Client Request                 │
└─────────────────────┬───────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────┐
│              FluxLB (Port 8080/8443)            │
│  ┌───────────────────────────────────────────┐  │
│  │         Smart Load Balancer               │  │
│  │  (Time-Quanta Based Scheduling)           │  │
│  └───────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────┐  │
│  │         Health Checker                     │  │
│  │  (10s intervals)                           │  │
│  └───────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────┐  │
│  │         React Dashboard                    │  │
│  │  (Real-time Metrics)                       │  │
│  └───────────────────────────────────────────┘  │
└─────────────────────┬───────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
        ▼             ▼             ▼
  ┌─────────┐   ┌─────────┐   ┌─────────┐
  │Backend 1│   │Backend 2│   │Backend 3│
  │ :8081   │   │ :8082   │   │ :8083   │
  └─────────┘   └─────────┘   └─────────┘
```

## Smart Scheduling Algorithm

FluxLB uses a sophisticated scheduling algorithm that considers:

1. **Time Quanta**: Average processing time per request
2. **Active Connections**: Current load on each backend
3. **Average Latency**: Historical performance

**Selection Formula:**
```
score = (time_quanta × (1 + active_connections)) + avg_latency
```

The backend with the **lowest score** is selected, ensuring:
- Fast backends get more requests
- Overloaded backends are avoided
- Optimal load distribution

## Troubleshooting

### Dashboard shows "Unauthorized"
- Make sure you're logged in
- Check cookies are enabled
- Try logging in again

### Backends showing as DOWN
- Check backends are running
- Verify health check path is correct (default: `/health`)
- Check firewall/network connectivity

### Can't add backend
- Ensure you're authenticated
- URL must start with http:// or https://
- Backend must be reachable from FluxLB

### Build errors
- Ensure Go 1.16+ is installed: `go version`
- Run: `go mod tidy`
- Try: `go clean -cache && go build`

## API Reference

See [README.md](README.md) for complete API documentation.

## Support

- GitHub Issues: https://github.com/devhub-sh/fluxlb/issues
- Documentation: [README.md](README.md)
